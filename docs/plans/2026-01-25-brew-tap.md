# e-bash Homebrew Distribution Plan

**Date:** 2026-01-25
**Status:** Approved
**Repo:** `artfulbits-se/homebrew-tap`

---

## Executive Summary

This plan outlines the setup for distributing `e-bash` via Homebrew using a custom tap repository. We will use a dedicated repository `artfulbits-se/homebrew-tap` to host the Formula. The distribution process is simplified to minimize maintenance overhead, leveraging git worktrees for managing the tap repository within the main project.

---

## 1. Architecture

### 1.1 Infrastructure
-   **Source Repo:** `OleksandrKucherenko/e-bash` (Automates the release)
-   **Tap Repo:** `artfulbits-se/homebrew-tap` (Hosts the `pb` formula)
-   **Method:** Universal Tap (Can host multiple formulas, starting with `e-bash`)

### 1.2 Repository Structure (`artfulbits-se/homebrew-tap`)

```text
homebrew-tap/
├── Formula/
│   └── e-bash.rb       # The Homebrew Definition
├── README.md           # Installation Instructions
└── LICENSE             # MIT
```

### 1.3 Worktree Integration
To simplify updates and management, the tap repository is added as a git worktree to the `e-bash` project:

-   **Remote Name:** `tap` -> `https://github.com/artfulbits-se/homebrew-tap.git`
-   **Local Path:** `.worktrees/homebrew-tap/` (Ignored by `.gitignore`)

This allows running release scripts that modify the Formula directly in the linked directory, commit, and push, without needing complex CI/CD token exchange dance for manual releases, or simplifying CI scripts.

---

## 2. Process

### 2.1 Release Workflow (Automated or Scripted)

When a new `e-bash` version (e.g., `v1.2.3`) is released:

1.  **Generate Artifact:** A release archive (`.tar.gz`) is created on GitHub Releases.
2.  **Calculate SHA256:** Compute the checksum of the archive.
3.  **Update Tap:**
    *   Navigate to `.worktrees/homebrew-tap`.
    *   Pull latest changes (`git pull`).
    *   Update `Formula/e-bash.rb` with new `url` and `sha256`.
    *   Commit: `feat: update e-bash to v1.2.3`.
    *   Push to `tap` remote.

### 2.2 Installation for Users

brew install artfulbits-se/tap/e-bash
```

*Note: Since the repo is named `homebrew-tap`, the short tap name is likely `artfulbits-se/tap`.*

---

## 3. Formula Design (`Formula/e-bash.rb`)

The formula will be simple, relying on the archive from GitHub Releases.

```ruby
class EBash < Formula
  desc "Comprehensive Bash script enhancement framework"
  homepage "https://github.com/OleksandrKucherenko/e-bash"
  url "https://github.com/OleksandrKucherenko/e-bash/archive/refs/tags/v<VERSION>.tar.gz"
  sha256 "<SHA256>"
  license "MIT"

  bottle :unneeded

  depends_on "bash"

  def install
    # Install core scripts to libexec (private)
    libexec.install Dir[".scripts/*"]

    # Install binaries
    bin.install Dir["bin/*"].reject { |f| File.directory?(f) }

    # Documentation and Demos
    doc.install "README.md", "LICENSE"
    (pkgshare/"demos").install Dir["demos/*"] if Dir.exist?("demos")
  end

  def caveats
    <<~EOS
      e-bash is installed to #{libexec}.
      Add the following to your shell profile:
        export E_BASH="#{opt_libexec}"
    EOS
  end

  test do
    assert_predicate libexec/"_logger.sh", :exist?
    system "#{bin}/e-bash", "help"
  end
end
```

---

## 4. Implementation Steps

### 4.1 Local Setup (Immediate Action)
- [x] Add remote `tap`: `git remote add tap https://github.com/artfulbits-se/homebrew-tap.git`
- [x] Fetch remote: `git fetch tap`
- [x] Create worktree: `git worktree add .worktrees/homebrew-tap tap/master` (or `main`)
- [x] Ensure `.worktrees/` is in `.gitignore`.

### 4.2 Repository Initialization
- [x] If empty, initialize `homebrew-tap` with `Formula/` folder and `README.md`.
- [x] Create initial `Formula/e-bash.rb`.

### 4.3 Scripting
- [x] Create `.github/scripts/release/release-brew-tap.sh` to automate the update process using the worktree.

---

## 5. Rollback
In case of a bad release:
1. Revert the commit in `homebrew-tap`.
2. Push force or push new commit.
3. Users run `brew upgrade` or `brew update`.
