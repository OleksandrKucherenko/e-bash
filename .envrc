# shellcheck disable=SC2148,SC2155

#
# Add scripts to PATH for simpler run
#
PATH_add "$PWD/.scripts"

#
# Load scripts: _logger <-- _commons <-- _dependencies
#
source "$PWD/.scripts/_dependencies.sh"

#
# Project dependencies
#
dependency bash "5.*.*" "brew install bash"
dependency direnv "2.*.*" "curl -sfL https://direnv.net/install.sh | bash"
dependency shellspec "0.28.*" "brew install shellspec"
optional kcov "42" "brew install kcov"
dependency shellcheck "0.9.*" "curl -sS https://webi.sh/shellcheck | sh"
dependency shfmt "3.*.*" "curl -sS https://webi.sh/shfmt | sh"
dependency watchman "2023.07.*.*" "brew install watchman"

export ALTSHFMT="$HOME/workspace/tmp/altshfmt/altshfmt"

#
# TDD via watchman
#
#
# ask watchman to automatically update auto-generated NGINX configuration
#
# `watchman-make -p '*.sh' '**/.shellspec' '**/*.rb' --run ./bin/build-local-config.sh`
watchman watch-project "$(pwd)" >/dev/null
# watchman -j <<-EOT
# ["trigger", ".", {
#   "name": "tdd-run-ebash-formatting",
#   "expression": ["anyof",
#     ["match", "*_spec.sh"],
#     ["match", "spec_helper.sh"],
#     ["match", ".shellspec"]
#   ],
#   "relative_root": ".",
#   "command": ["./00-format.sh"]
# }]
# EOT
