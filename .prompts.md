Read:
- .scripts/_hooks.sh
- docs/public/hooks.md
- spec/hooks_spec.sh
- demos/demo.hooks-logging.sh
- demos/demo.hooks-nested.sh
- demos/demo.hooks-registration.sh
- demos/demo.hooks.sh

We need to extent the functionality of the hooks by designing middleware abstration for hooks. 
Idea: middleware function is responsible for processing return code and stdout/stderr of the hook and introduce side-effects into main script. 
Purpose: middleware in this way can allow to build "protocol" between hook and main script, protocol - that will understand commands from hook side, like return code 11 - will mean that we should switch main script to DRY_RUN mode.

by default all hooks are using default inner protocol - 0 - success, 1 - error, stdout/stderr print as is. 

exceptions:
- middleware designed only for "script" mode, not for "source" mode

Sample:
- we are building sample/demo in `demos/ci-mode` folder

Expectations:
- compose middleware sample that will allow to implement modes: dry, ok, error, skip, timeout, test in a simpler way (all those modes are influence on how main script should continue the execution)
- you can use 'contract' instead of 'protocol'. ref: contract testing.

draft of the plan is available: `docs/HOOKS_MIDDLEWARE.md`


Read skill experience: @.claude/skills/shellspec/references/collected-experience.md