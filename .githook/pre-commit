#!/usr/bin/env bash

# Main pre-commit hook that orchestrates multiple pre-commit checks

# Ensure GNU utilities bundled in bin/gnubin are available for every hook
REPO_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd)
GNUBIN_DIR="$REPO_ROOT/bin/gnubin"
if [[ -d "$GNUBIN_DIR" && ":$PATH:" != *":$GNUBIN_DIR:"* ]]; then
  export PATH="$GNUBIN_DIR:$PATH"
fi

# First, run copyright verification
HOOK_DIR="$(dirname "$0")"
"$HOOK_DIR/pre-commit-copyright"
COPYRIGHT_VERIFY_EXIT_CODE=$?

# If copyright verification failed, abort commit
if [ $COPYRIGHT_VERIFY_EXIT_CODE -ne 0 ]; then
  exit $COPYRIGHT_VERIFY_EXIT_CODE
fi

# Continue with updating "Last revisit" date in modified files
"$HOOK_DIR/pre-commit-copyright-last-revisit"
REFRESH_DATE_EXIT_CODE=$?

# If date refresh failed, abort commit
if [ $REFRESH_DATE_EXIT_CODE -ne 0 ]; then
  exit $REFRESH_DATE_EXIT_CODE
fi

exit 0
